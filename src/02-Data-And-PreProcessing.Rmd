---
title: "01-Dataset and Simulations"
output:
  pdf_document: default
  html_document: default
---


```{r load libraries, message=FALSE, warning=FALSE, include=FALSE}
setwd("D:/Assembla/deduplication")
source("src/config/libraries.R")
source("src/lib/helpers.R")
source("src/munge/01-A.R")
```

# Dataset and Simulation

This chapter explains the process of generating the dataset and the pre-processing steps to infuse real-world problems into it.

##Data Preparation  

The dataset currently used for analysis is simulated.  There are two datasets 1customer10000 and 2customer10000 that holds identical number of rows and the same parameters, but generated with different seed values.
 <center>![Test data generation](data-generation.png)</center>

The data is generated using Php and inserted to Postgresql db and further exported to .csv files.  There are two dataset generated in the same manner with same seed values:  one with 2k records for initial solution building and a 50k set for further validation of the solution.  


##Description of the Dataset

The following table gives a description of the dataset used for analysis:

Total number of rows in the dataset = `r nrow(base.ds)`


```{r, echo=FALSE, message=FALSE, warning=FALSE}

panderOptions('table.alignment.default','left')
pander(desc.base.ds, caption="Description of Dataset", short= TRUE, split.tables=150)

```

The original dataset is unique across all fields.  Each of the records is furnished with an identity key so that it can be tracked at all times.s.  

##Simulation of real world data issues:

The data is simulated to reflect real-life anomalies regards to data.  A controlled (monitored) simulation of anomalies will help evaluate the capability of the solution to manage deduplication of records.  

Subsequently, once the solution is established, the same solution could be applied to a larger record base do assess the extensibility of the solution.  

```{r, message=FALSE, warning=FALSE, include=FALSE}
pre.process <-as.data.frame(matrix(ncol = 3, nrow = 0))
colnames(pre.process) <- c("Sl.No.","Change","Description")

```



```{r, message=FALSE, warning=FALSE, include=FALSE}
p <- 3 # Change this percentage to modify higher percentages:
new.base.ds <- base.ds

changes.ds <-  data.frame(matrix(0, ncol = ncol(base.ds), nrow = 0))
colnames(changes.ds) <- colnames(base.ds)
changes.ds$some.id <- as.character(changes.ds$some.id)
changes.ds$m.nmbr <- as.character(changes.ds$m.nmbr)
changes.ds$h.nmbr <- as.character(changes.ds$h.nmbr)
changes.ds$birth.date <- as.character(changes.ds$birth.date)
changes.ds$postcode <- as.character(changes.ds$postcode)
# panderOptions('table.alignment.default','left')
# pander(temp.ds, caption="Description of Dataset", short= TRUE, split.tables=150)
```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Missing e-mail ID
remove(temp.ds)
p <- 20
## Provide number of the column whose value needs to be changed
#new.base.ds <- removeColumnValue(new.base.ds,7,20)
new.base.ds$email[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''
pre.process[1,c(2:3)] <- c("Missing email ids", paste(p, "% of records updated to remove email ids"))


```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Missing Home phone numbers
remove(temp.ds)
p <- 40
new.base.ds$h.nmbr[sample(nrow(new.base.ds), nrow(new.base.ds)*40/100)] <- ''
pre.process[2,c(2:3)] <- c("Missing hone phone numbers", paste(p, "% of records updated to remove home phone numbers"))

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Missing Mobile phone numbers
remove(temp.ds)
p <- 20
new.base.ds$m.nmbr[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''
pre.process[3,c(2:3)] <- c("Missing mobile phone numbers", paste(p, "% of records updated to remove mobile phone numbers"))

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Missing Postcode from Address
remove(temp.ds)
p <- 25
new.base.ds$postcode[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''
pre.process[4,c(2:3)] <- c("Missing postcodes from address", paste(p, "% of records updated to remove postcode"))

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Missing Address 1 from Address
remove(temp.ds)
p <- 15
new.base.ds$addr.1[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''
pre.process[5,c(2:3)] <- c("Missing address 1", paste(p, "% of records updated to remove address 1"))

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Missing Address 2 from Address
remove(temp.ds)
p <- 10
new.base.ds$addr.2[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''
pre.process[6,c(2:3)] <- c("Missing address 2", paste(p, "% of records updated to remove address 2"))

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Missing County Name from Address
remove(temp.ds)
p <- 30
new.base.ds$county[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''
pre.process[7,c(2:3)] <- c("Missing Country", paste(p, "% of records updated to remove Country"))

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Missing City Name from Address
remove(temp.ds)
p <- 20
new.base.ds$cityname[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''
pre.process[8,c(2:3)] <- c("Missing Cityname", paste(p, "% of records updated to remove Cityname"))

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Same Address
p <- 3
temp.ds <- updateAddress(new.base.ds,p)
changes.ds <- rbind(changes.ds,temp.ds)
pre.process[9,c(2:3)] <- c("Identical Address", paste(nrow(temp.ds), "% of records updated to have identical address"))

```




```{r, message=FALSE, warning=FALSE, include=FALSE}
###Records for identical Twins living in the same address
p <- 1
remove(temp.ds)

temp.ds <- updateTwins(new.base.ds,p)
changes.ds <- rbind(changes.ds,temp.ds)
pre.process[10,c(2:3)] <- c("Twins living in the same house", paste(nrow(temp.ds), "records are created with same last name and a random first name from the dataset to simulate twins living in the same house.  The record.id is tagged with 'T' to identify these records."))

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
###Records for Married couples living in the same address
p <- 10
remove(temp.ds)

temp.ds <- updateCouples(new.base.ds,p)
changes.ds <- rbind(changes.ds,temp.ds)
pre.process[11,c(2:3)] <- c("Couples living in the same address", paste(nrow(temp.ds), "records created for couples living in the same house:",
"The First Name is changed. " ,
"The gender is changed to the opposite of the originial record. " ,
"The record.id is tagged with 'C' to identify these records. "  ,
"The date, month and year in DoB is changed  to a random number. ",
"The forename is changed to a random name. " ))

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
###Altering name to simulate spelling mistakes
p <- 75

temp.ds <- alterFirstName(new.base.ds,"John","Jon",p)
changes.ds <- rbind(changes.ds,temp.ds)
temp.ds <- alterFirstName(new.base.ds,"Thompson","Thomson",p)
changes.ds <- rbind(changes.ds,temp.ds)
temp.ds <- alterFirstName(new.base.ds,"tt","t",p)
changes.ds <- rbind(changes.ds,temp.ds)

temp.ds <- alterLastName(new.base.ds,"ss","s",p)
changes.ds <- rbind(changes.ds,temp.ds)

pre.process[12,c(2:3)] <- c("Altering name to simulate spelling mistakes", paste(nrow(temp.ds), "of the records with a particular name is changed to a new one to simulate spelling mistatakes:  
'John' is changed to 'Jon'  
'Thompson' is changed to 'Thomson'  
'tt' of words changed to single 't'" ))

pre.process[,c(1)]<- c(1:nrow(pre.process))
colnames(pre.process) <- c("Sl.No","Scenario","Description")


panderOptions('table.alignment.default','left')
pander(pre.process, caption="Preprocessing Dataset", short= TRUE, split.tables=250)
```

  


**Total Number of Records Added: `r nrow(changes.ds) ` **  

##Preprocessing

###Original Dataset updated with changes

```{r, message=FALSE, warning=FALSE, include=FALSE}
new.base.ds <- rbind(new.base.ds, changes.ds)

```


The original dataset is updated with changes.  The total number of records for analysis is :  ** `r nrow(new.base.ds)` **

###Other Changes

1.  The Character string are converted to lower case before comparison
2.  Multiple character spaces are modified to single character spaces

```{r, message=FALSE, warning=FALSE, include=FALSE}
new.base.ds$forename <- tolower(new.base.ds$forename)
new.base.ds$surname <- tolower(new.base.ds$surname)
new.base.ds$addr.1 <- tolower(new.base.ds$addr.1)
new.base.ds$addr.2 <- tolower(new.base.ds$addr.2)
new.base.ds$cityname <- tolower(new.base.ds$cityname)
new.base.ds$county <- tolower(new.base.ds$county)

# Remove unused objects from memory
remove(p,desc.base.ds,temp.ds,cust.rcds)

```

