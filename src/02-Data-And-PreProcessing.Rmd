---
title: "01-Dataset and Simulations"
output:
  pdf_document: default
  html_document: default
---


```{r load libraries, message=FALSE, warning=FALSE, include=FALSE}
setwd("D:/Assembla/deduplication")
source("src/config/libraries.R")
source("src/lib/helpers.R")
source("src/munge/01-A.R")
```

# Dataset and Simulation

This chapter explains the process of generating the dataset and making it reflectIt is important to understand the data that is being used to execute this analysis not only from a research reproducability perspective, but also to understand the extent to which problem scenearios are covered from a practical angle.

##Data Preparation  

The dataset currently used for analysis is simulated.  There are two datasets 1customer10000 and 2customer10000 that holds identical number of rows and the same parameters, but generated with different seed values.
 <center>![Test data generation](data-generation.png)</center>

The data is generated using Faker in Laravel, a PhP framework.  The Faker framework is flexible to impute simulated values to prepare a wide range of test data.  However, the 100,000 records generated by Faker is distinct across each other and forms very little of interest to us from a research angle.  


##Description of the Dataset

The following table gives a description of the dataset used for analysis:

Total number of rows in the dataset = `r nrow(base.ds)`


```{r, echo=FALSE, message=FALSE, warning=FALSE}

panderOptions('table.alignment.default','left')
pander(desc.base.ds, caption="Description of Dataset", short= TRUE, split.tables=150)


```

The original dataset is unique across all fields.  For a controlled experiment, the dataset is simulated to reflect real-life scenario in the context of bad customer records.  The data is simulated to reflect real-life anomalies regards to data.  A controlled (monitored) simulation of anomalies will help evaluate the capability of the solution to manage deduplication of records.

Subsequently, once the solution is established, the same solution could be applied to a larger record base do assess the extensibility of the solution.

##Simulation of real world anomalies:


```{r, message=FALSE, warning=FALSE, include=FALSE}
p <- 3 # Change this percentage to modify higher percentages:
new.base.ds <- base.ds

changes.ds <-  data.frame(matrix(0, ncol = ncol(base.ds), nrow = 0))
colnames(changes.ds) <- colnames(base.ds)
changes.ds$cust.id <- as.character(changes.ds$cust.id)
changes.ds$m.nmbr <- as.character(changes.ds$m.nmbr)
changes.ds$h.nmbr <- as.character(changes.ds$h.nmbr)
changes.ds$birth.date <- as.character(changes.ds$birth.date)
changes.ds$postcode <- as.character(changes.ds$postcode)
# panderOptions('table.alignment.default','left')
# pander(temp.ds, caption="Description of Dataset", short= TRUE, split.tables=150)
```



###Missing e-mail ID


```{r, message=FALSE, warning=FALSE, include=FALSE}
remove(temp.ds)
p <- 20
## Provide number of the column whose value needs to be changed
#new.base.ds <- removeColumnValue(new.base.ds,7,20)
new.base.ds$email[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''

```

`r p`% of the records are updated to remove their email IDs.  

###Missing Home phone numbers


```{r, message=FALSE, warning=FALSE, include=FALSE}
remove(temp.ds)
p <- 40
new.base.ds$h.nmbr[sample(nrow(new.base.ds), nrow(new.base.ds)*40/100)] <- ''

##
```


`r p`% of  customer records are updated to remove home phone numbers.  

###Missing Mobile phone numbers


```{r, message=FALSE, warning=FALSE, include=FALSE}
remove(temp.ds)
p <- 20
new.base.ds$m.nmbr[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''

##
```

`r p`% of  customer records are updated to remove mobile phone numbers.  


###Missing Postcode from Address

```{r, message=FALSE, warning=FALSE, include=FALSE}
remove(temp.ds)
p <- 25
new.base.ds$postcode[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''

##
```

`r p`% of  customer records are updated to remove Postcode from their addresses.  


###Missing Address 1 from Address

```{r, message=FALSE, warning=FALSE, include=FALSE}
remove(temp.ds)
p <- 15
new.base.ds$addr.1[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''

##
```

`r p`% of  customer records are updated to remove Address line 1 from their addresses.  



###Missing Address 2 from Address

```{r, message=FALSE, warning=FALSE, include=FALSE}
remove(temp.ds)
p <- 10
new.base.ds$addr.1[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''

##
```

`r p`% of  customer records are updated to remove Address line 2 from their addresses.  




###Missing County Name from Address


```{r, message=FALSE, warning=FALSE, include=FALSE}
remove(temp.ds)
p <- 30
new.base.ds$county[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''

##
```


`r p`% of  customer records are updated to remove County from their addresses.  

###Missing City Name from Address


```{r, message=FALSE, warning=FALSE, include=FALSE}
remove(temp.ds)
p <- 20
new.base.ds$cityname[sample(nrow(new.base.ds), nrow(new.base.ds)*p/100)] <- ''

```


`r p`% of  customer records are updated to remove City Name from their addresses.  


###Same Address

```{r, message=FALSE, warning=FALSE, include=FALSE}

p <- 3
temp.ds <- updateAddress(new.base.ds,p)
changes.ds <- rbind(changes.ds,temp.ds)

# panderOptions('table.alignment.default','left')
# pander(temp.ds, caption="Description of Dataset", short= TRUE, split.tables=150)
```

`r nrow(temp.ds)` customer records are updated to have identical address:


###Records for identical Twins living in the same address

```{r, message=FALSE, warning=FALSE, include=FALSE}
p <- 1
remove(temp.ds)

temp.ds <- updateTwins(new.base.ds,p)
changes.ds <- rbind(changes.ds,temp.ds)
# panderOptions('table.alignment.default','left')
# pander(temp.ds, caption="Description of Dataset", short= TRUE, split.tables=150)
```


`r nrow(temp.ds)` records are created with same last name and a random first name from the dataset to simulate twins living in the same house.  The record.id is tagged with 'T' to identify these records.


###Records for Married couples living in the same address

```{r, message=FALSE, warning=FALSE, include=FALSE}
p <- 10
remove(temp.ds)

temp.ds <- updateCouples(new.base.ds,p)
changes.ds <- rbind(changes.ds,temp.ds)
# panderOptions('table.alignment.default','left')
# pander(temp.ds, caption="Description of Dataset", short= TRUE, split.tables=150)
```

`r nrow(temp.ds)` records created for couples living in the same house:  
The First Name is changed  
The gender is changed to the opposite of the originial record  
The record.id is tagged with 'C' to identify these records  
The date, month and year in DoB is changed  to a random number  
The forename is changed to a random name  


###Altering name to simulate spelling mistakes

```{r, message=FALSE, warning=FALSE, include=FALSE}
p <- 3

temp.ds <- alterFirstName(new.base.ds,"John","Jon")
changes.ds <- rbind(changes.ds,temp.ds)
temp.ds <- alterFirstName(new.base.ds,"Thompson","Thomson")
changes.ds <- rbind(changes.ds,temp.ds)
temp.ds <- alterFirstName(new.base.ds,"tt","t")
changes.ds <- rbind(changes.ds,temp.ds)

temp.ds <- alterLastName(new.base.ds,"ss","s")
changes.ds <- rbind(changes.ds,temp.ds)




# panderOptions('table.alignment.default','left')
# pander(temp.ds, caption="Description of Dataset", short= TRUE, split.tables=150)
```

Half of the records with a particular name is changed to a new one to simulate spelling mistatakes:  
'John' is changed to 'Jon'  
'Thompson' is changed to 'Thomson'  
'tt' of words changed to single 't'  


**Total Number of Records Added: `r nrow(changes.ds) ` **  

##Preprocessing

###Original Dataset updated with changes

```{r, message=FALSE, warning=FALSE, include=FALSE}
new.base.ds <- rbind(new.base.ds, changes.ds)

```


The original dataset is updated with changes.  The total number of records for analysis is :  ** `r nrow(base.ds)` **

###Change the Character fields to lowercase

```{r}
new.base.ds$forename <- tolower(new.base.ds$forename)
new.base.ds$surname <- tolower(new.base.ds$surname)
new.base.ds$addr.1 <- tolower(new.base.ds$addr.1)
new.base.ds$addr.2 <- tolower(new.base.ds$addr.2)
new.base.ds$cityname <- tolower(new.base.ds$cityname)
new.base.ds$county <- tolower(new.base.ds$county)

# Remove unused objects from memory
remove(p,desc.base.ds,temp.ds)

```

